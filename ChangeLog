2008-10-30  Sven Neumann  <sven@gimp.org>

	* Made 2.6.2 release.

2008-10-30  Sven Neumann  <sven@gimp.org>

	Backed out this change for now as it causes problem with some
	window managers:

        Bug 556896 – Dialogs don't get minimized with single image window

	* app/display/gimpdisplayshell.c
	* app/display/gimpdisplay-foreach.[ch]
	* app/widgets/gimpdialogfactory.[ch]: merged changes from trunk.
	Hide the toolbox and docks if the last display is iconified.
	Unhide them if a display is uniconified.

2008-10-29  Sven Neumann  <sven@gimp.org>

 	Merged from trunk:

	Bug 557950 – Scaling in Gimp 2.6 is much slower than in Gimp 2.4

        * app/paint-funcs/scale-region.c: don't do multi-pass scaling
	when we are scaling up.

2008-10-29  Martin Nordholts  <martinn@svn.gnome.org>

	Merged from trunk:

	Bug 558215 – unit and zoom entries in Statusbar not visible

	* app/display/gimpdisplayshell-callbacks.c
	(gimp_display_shell_canvas_size_allocate): Don't try to be clever,
	call gimp_display_shell_scaled() whenever the canvas size changes
	so a newly created display shell gets updated properly.

2008-10-29  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	Bug 558451 – Cannot build GIMP using Sun CC on Solaris 2.8

	* app/pdb/gimp-pdb-compat.c
	* app/gegl/gimpoperationtilesink.c
	* app/gegl/gimpoperationtilesource.c
	* app/tools/gimpgegltool.c: applied patches from Eric Lamarque
	fixing the build using Sun CC on Solaris.

2008-10-29  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	Bug 558420 – projection incorrect with alpha-less layers

	* app/core/gimpprojection-construct.c (gimp_projection_initialize):
	need to initialize the projection if the covering layer is not
	opaque.

2008-10-28  Martin Nordholts  <martinn@svn.gnome.org>

	Merged from trunk:

	Bug 556603 – Zoom region always zooms in center of image

	* app/tools/gimpmagnifytool.c (gimp_magnify_tool_button_release):
	When zooming with a click, use gimp_display_shell_scale() instead
	of local zoom logic.

2008-10-25  Michael Natterer  <mitch@gimp.org>

	Merged from trunk:

	Bug 557870 – "Qmask" message popping up here and there

	* app/display/gimpdisplayshell-title.c
	(gimp_display_shell_format_title): use
	gimp_viewable_get_description() instead of gimp_object_get_name()
	for displaying the active drawable's name so the quick mask and
	the floating selection have the same names as in the
	layers/channels dialogs.

2008-10-24  Sven Neumann  <sven@gimp.org>

	Bug 557705 – compatibility with GEGL > 0.0.20

	* app/core/gimpdrawable-brightness-contrast.c
	* app/core/gimpdrawable-invert.c
	* app/tools/gimpbrightnesscontrasttool.c: choose GEGL operation
	names based on the GEGL version we are being used with.

2008-10-24  Sven Neumann  <sven@gimp.org>

	Bug 557705 – compatibility with GEGL > 0.0.20

	* app/gegl/gimp-gegl-utils.[ch]: added gimp_gegl_check_version(),
	a run-time GEGL version check.

	* app/core/gimpimagemap.c (gimp_image_map_apply): use the new
	function to determine the names of the GEGL ops to use.

2008-10-24  Sven Neumann  <sven@gimp.org>

        Bug 556896 – Dialogs don't get minimized with single image window

	* app/display/gimpdisplayshell.c
	* app/display/gimpdisplay-foreach.[ch]
	* app/widgets/gimpdialogfactory.[ch]: merged changes from trunk.
	Hide the toolbox and docks if the last display is iconified.
	Unhide them if a display is uniconified.

2008-10-24  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

        Bug 556248 – Scaling gives 'jagged' edges

        * app/paint-funcs/scale-region.c (scale): calculate pixel
        contributions based on pixel centers, not on pixel origins.

2008-10-23  Michael Natterer  <mitch@gimp.org>

	Merged from trunk:

	* app/plug-in/gimppluginprocframe.c
	(gimp_plug_in_proc_frame_dispose): set proc_frame->procedure to
	NULL *after* calling gimp_plug_in_cleanup(). Fixes the crash on
	windows in bug #557061 (but not the bug).

2008-10-23  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* configure.in: removed check for Carbon and added a test for the
	target OS being Darwin instead.

	* app/config/gimpguiconfig.c: use PLATFORM_OSX instead of
	HAVE_CARBON to determine the default "web-browser" command.

2008-10-22  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* plug-ins/print/print-preview.c (print_preview_leave_notify_event):
	check the crossing mode and don't unset the "inside" flag when the
	event is caused by a pointer grab/ungrab.

2008-10-22  Martin Nordholts  <martinn@svn.gnome.org>

	Merged from trunk:

	Bug 556804 – Zoom drop down doesn't update

	* app/display/gimpdisplayshell-scale.c
	* app/display/gimpdisplayshell-callbacks.c: Fix calls to
	gimp_display_shell_scaled() when Resize window on zoom is enabled.

2008-10-22  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	Bug 524615 – Print not to scale

	* plug-ins/print/print.c: set the unit for dimensions on the Cairo
	context used for printing to GTK_UNIT_PIXELS.

	* plug-ins/print/print-draw-page.c (print_draw_page): changed the
	Cairo scale factors accordingly. Seems to fix printing on Windows.

2008-10-22  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* app/widgets/gimpprogressbox.c: set box->progress to NULL in
	destroy() and check for progress being NULL in various places so
	we don't crash on API calls after the widget is destroyed.

2008-10-22  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	Bug 555246 – gimp crashes when a file is opened while a preview is
	generating

	* app/widgets/gimpthumbbox.c: set box->progress to NULL in
	destroy() and check for progress being NULL in various places so
	we don't crash on API calls after the widget is destroyed.

2008-10-22  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	Bug 556741 – Alpha layer automatically added (in psd format) but
	not desired

	* plug-ins/file-psd/psd-save.c: applied patch from Dennis Ranke
	that flattens the projection for indexed images.

2008-10-22  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

        * app/widgets/gimpfiledialog.c: set dialog->progress to NULL in
        destroy() and check for progress being NULL in various places so
        we don't crash on API calls after the widget is destroyed.

2008-10-21  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* app/tools/gimpgegltool.c (gimp_param_spec_duplicate):
	GEGL_IS_PARAM_SPEC_PATH() became GEGL_IS_PARAM_SPEC_FILE_PATH()
	in GEGL 0.0.21.

	* app/tools/gimpgegltool.c (gimp_gegl_tool_dialog): for the
	combo-box, strip known prefixes from the GEGL operation names and
	use icons instead.

2008-10-21  Sven Neumann  <sven@gimp.org>

	* app/tools/gimpgegltool.c (gimp_gegl_tool_operation_blacklisted):
	make the operations blacklist work with GEGL >= 0.0.21.

2008-10-21  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* app/actions/file-commands.c (file_open_recent_cmd_callback): ref
	the GimpDisplay and GimpImageFile objects while holding a
	reference to them. Fixes a potential crash if GIMP is closed while
	the image is being loaded.

2008-10-20  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* app/widgets/gimperrorconsole.c (gimp_error_console_init): don't
	make the font size even smaller. We already use a smaller font in
	the dock windows.

2008-10-17  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* plug-ins/file-psd/psd-save.c (xfwrite): fixed handling of empty
	strings. Don't quit silently, write an error message to stderr at
	least.

2008-10-17  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* app/core/gimp.[ch]: added signal Gimp::image-opened to announce
	that an image has been loaded and a display was created for it.

	* app/file/file-open.c (file_open_with_proc_and_display): call
	gimp_image_opened() to emit the new signal.

	* app/gui/dbus-service.xml
	* app/gui/gimpdbusservice.[ch]: propagate the 'opened' signal to
	listeners of the "org.gimp.GIMP.UI" DBus service.

	* app/gui/gui-unique.c: formatting.

2008-10-14  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* themes/Default/images/stock-gegl.svg
	* themes/Default/images/stock-gegl-22.svg
	* themes/Default/images/stock-gegl-22.png: remove white from the
	shadow to render correctly on dark backgrounds.

2008-10-14  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	* app/widgets/gimpdialogfactory.c (gimp_dialog_factory_add_dialog):
	let new docks appear at the pointer position.

2008-10-13  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	Bug 556182 – Could you please explain a few strings [I18N]

	* plug-ins/pygimp/plug-ins/py-slice.py: added translator comments.

2008-10-10  Michael Natterer  <mitch@gimp.org>

	Merged from trunk:

	* app/tools/gimpmovetool.c (gimp_move_tool_button_release): flush
	the image after setting active items back from temporarily
	selected ones. Fixes menu item sensitivity.

2008-10-09  Sven Neumann  <sven@gimp.org>

	Merged from trunk:

	Bug 555697 – build fails if configured with --without-libjpeg

	* plug-ins/Makefile.am: applied patch from Simon Zilliken that
	disables the build of the PSD plug-in if JPEG support is disabled.

2008-10-09  Michael Natterer  <mitch@gimp.org>

	Merged from trunk:

	This is not exactly a bugfix-only commit, but fixing this bug
	was the original reason for all the curve and image map tool
	refactorings that went into 2.6. It would be silly not to
	fix it just because I simply forgot to hack the final step of
	enabling all the new code. The two new translatable strings are
	a PITA, sorry about that; but better than still only exporting
	the old curves and levels formats in 2.6.

	Bug 134956 – Curves tool doesn't save free curves

	* app/core/gimpmarshal.list
	* app/widgets/gimpsettingsbox.[ch]: add signal "file-dialog-setup"
	and emit it when the export/import file chooser is fully
	constructed. Callbacks can then do additional things to the
	dialog, like adding custom buttons.

	* app/tools/gimpcurvestool.h
	* app/tools/gimplevelstool.h: add boolean member
	"export_old_format".

	* app/tools/gimpcurvestool.c
	* app/tools/gimplevelstool.c (gimp_*_tool_dialog): connect to
	the settings box' "file-dialog-setup".

	(gimp_*_tool_export_setup): new callback which adds a toggle to
	the file choosers that allows to export to the old format.
	Default saving the new format, we defaulted to the old one before.

	(gimp_*_tool_settings_export): check the "export_old_format"
	boolean and only save the cruft format if it is TRUE; chain up
	otherwise, which generically saves the new format.

	* app/tools/gimplevelstool.c (gimp_levels_tool_settings_import):
	add the same file format detection code as in the curves tool
	so it transparently loads old and new levels files.

2008-10-09  Michael Natterer  <mitch@gimp.org>

	Merged from trunk:

	* app/gegl/gimpcurvesconfig.c (gimp_curves_config_save_cruft):
	when saving a curve of type GIMP_CURVE_FREE, don't use
	gimp_curve_get_point() because that returns nothing for free
	curves.

	(gimp_curves_config_load_cruft): reset the curve before loading it.

	* app/core/gimpcurve.c (gimp_curve_get_point): instead of above
	mentioned uninitialized nonsense, at least return -1,-1 for free
	curves.

2008-10-09  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version to 2.6.2 (interface age 2).

2008-10-09  Sven Neumann  <sven@gimp.org>

	* Made 2.6.1 release.

2008-10-08  Martin Nordholts  <martinn@svn.gnome.org>

	Bug 555587 – PSD file crashes PSD plug-in

	* plug-ins/file-psd/psd-load.c (add_merged_image): Handle
	img_a->alpha_names being NULL.

2008-10-08  Michael Natterer  <mitch@gimp.org>

	* libgimpwidgets/gimpruler.c: cosmetics.

2008-10-08  Michael Natterer  <mitch@gimp.org>

	Quick hack I needed for debugging and which doesn't hurt:

	* tools/test-clipboard.c (test_clipboard_paste): allow to paste to
	STDOUT by passing '-' as filename.

2008-10-08  Martin Nordholts  <martinn@svn.gnome.org>

	* plug-ins/file-psd/psd-load.c (add_layers): Decrease scope of
	comp_mode and initialize it.

2008-10-08  Martin Nordholts  <martinn@svn.gnome.org>

	Bug 555222 – PSD Load Plugin: unsupported compression mode

	* plug-ins/file-psd/psd-load.c (add_layers): Some PSD files can
	have channels where a compression method used for the channel data
	is specified, but without any actual channel data. Handle this
	case. Fix inspired by patch from Chris Mohler.

2008-10-08  Sven Neumann  <sven@gimp.org>

	* app/base/tile-cache.c: use a GMutex instead of a GStaticMutex
	as the latter needs API that causes compiler warnings about
	dereferencing of type-punned pointers.

2008-10-07  Michael Natterer  <mitch@gimp.org>

	Bug 555362 – gimp-remote is not working properly

	* app/widgets/gimptoolbox-dnd.c (gimp_toolbox_dnd_init): add the
	window itself as drop traget again so gimp-remote works.

2008-10-07  Michael Natterer  <mitch@gimp.org>

	* app/*/Makefile.am: reorder sections consistently. Remove
	redundant CFLAGS.

2008-10-06  Sven Neumann  <sven@gimp.org>

	Bug 555280 – some gif files will not be open

	* plug-ins/common/file-gif-load.c (GetCode): be more tolerant and
	continue loading with a warning message if there are bits missing
	at the end of the file.

2008-10-06  Sven Neumann  <sven@gimp.org>

	* app/paint-funcs/scale-region.c (scale_region): removed debug
	output.

2008-10-06  Michael Natterer  <mitch@gimp.org>

	* plug-ins/common/file-gih.c
	* plug-ins/common/file-xbm.c: setting a spin button's
	page_increment to 1 is of no use, set it to 10 instead.

2008-10-06  Michael Natterer  <mitch@gimp.org>

	* app/plug-in/plug-in-menu-path.c (menu_path_mappings): add a
	fallback mapping from <Toolbox> to <Image> so we catch really
	everything that wants to go to <Toolbox>.

2008-10-06  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpcontext.c (gimp_context_real_set_display): paranoia
	fix for hypothetical but harmful misbehavior: when setting the
	display from !=NULL to NULL, also set the image to NULL instead of
	relying on whatever obscure implicit behavior of other parts of
	GIMP which set a new display right away or make sure the image
	goes away together with the display.

2008-10-06  Michael Natterer  <mitch@gimp.org>

	* app/core/gimplayer.c (gimp_layer_add_mask): g_return_if_fail()
	on the mask's image being the same as the layer's image. The PDB
	already checks for this.

	* app/core/gimpimage.c (gimp_image_add_layer,channel,vectors):
	remove calls to gimp_item_set_image() because we only accept
	itmes of this image anyway.

2008-10-05  Michael Natterer  <mitch@gimp.org>

	* app/plug-in/gimpplugin-cleanup.c
	* app/vectors/gimpanchor.c: #include <glib-object.h>, not
	"glib-object.h".

2008-10-05  Michael Natterer  <mitch@gimp.org>

	* app/gegl/gegl-types.h: including ourselves serves no purpose.

2008-10-05  Michael Natterer  <mitch@gimp.org>

	Allow to "Open as Layers" in the empty display:

	* app/widgets/gimpfiledialog.[ch]: add member
	"gboolean open_as_layers". Rename gimp_file_dialog_set_image() to
	gimp_file_dialog_set_save_image() and add
	gimp_file_dialog_set_open_image() which sets both the image to
	load layers into and the "open_as_layers" boolean.

	* app/dialogs/file-open-dialog.c (file_open_dialog_response): look
	at dialog->open_as_layers instead of dialog->image to decide whether
	to open as layers (that's much more obvious). Enable open as layers
	without existing image by creating the image if it doesn't exist.

	* app/actions/file-commands.c (file_open_dialog_show): add "title"
	parameter and take the uri from the image if none was passed. Use the
	new gimp_file_dialog_set_open_image() instead of poking into the
	dialog struct. Change callers to pass the title and not get the
	uri from the image; instead always pass the image.

	* app/actions/file-actions.c (file_actions_update): keep
	"Open as Layers" sensitive even without image.

2008-10-05  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpimage-contiguous-region.c: some formatting cleanups.

	(find_contiguous_segment): changed to return gboolean not gint.

2008-10-05  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpruler.c: cache the PangoLayout. Use it not
	only for drawing the numbers, but also to calculate the size
	requisition depending on the actual font size.

2008-10-05  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpruler.c: instead of hardcoding a size
	request, implement GtkWidget::size_request and set the size
	depending on the font-scale.

2008-10-05  Sven Neumann  <sven@gimp.org>

	Bug 554890 – JPEG Save Options Dialog does not remember
	Subsampling mode

	* plug-ins/file-jpeg/jpeg.c (run): fixed problem introduced by the
	use of an enum for the subsampling factor.

2008-10-04  Michael Natterer  <mitch@gimp.org>

	* plug-ins/common/web-browser.c: return errors via return_vals
	instead of displaying them with g_message().

2008-10-04  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpruler.c: increased ruler font scale from
	X_SMALL to SMALL as it appears to be too small for many users.

	* themes/Default/gtkrc: follow that change here, but keep the
	ruler font extra small in the Small theme.

2008-10-04  Sven Neumann  <sven@gimp.org>

	* plug-ins/file-jpeg/jpeg-save.c: some cleanups to the subsampling
	code; in an attempt to fix bug #555031.

2008-10-04  Sven Neumann  <sven@gimp.org>

	* INSTALL: updated GTK+ requirement.

2008-10-04  Michael Natterer  <mitch@gimp.org>

	* configure.in: depend on GTK+ 2.12.5 so motion history events of
	extended input devices have proper timestamps needed by paint
	tools.

2008-10-04  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpruler.c: make the font scale factor
	configurable in gtkrc.

	* themes/Default/gtkrc
	* themes/Small/gtkrc: for documentation, add the default value here.

2008-10-03  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/web-browser.c (browser_open_url): removed
	trailing whitespace and corrected error message.

2008-10-03  Hans Breuer  <hans@breuer.org>

	* plug-ins/common/web-browser.c : when ShellExecute() is failing give
	the detailed (currently intentionally untranslated) error message via
	g_message()

	* **/makefie.msc gimpdefs.msc app/gimpcore.def : updated
	* app/core/gimpcurve.c : include <string.h> for memcmp()
	* app/gegl/gimpcurvesconfig.c : include <string.h> for strcmp()

2008-10-03  Sven Neumann  <sven@gimp.org>

	Bug 554966 – Gimp crashes creating a new image using a template

	* app/display/gimpdisplayshell-scale.c
	(gimp_display_shell_scale_update_scrollbars)
	(gimp_display_shell_scale_update_rulers): bail out early if
	shell->display is NULL.

2008-10-03  Michael Natterer  <mitch@gimp.org>

	Bug 554785 – Compile failure on uri-backend-libcurl

	* plug-ins/file-uri/uri-backend-libcurl.c: apply patch from Robby
	Workman which fixes the build for this file.

2008-10-03  Sven Neumann  <sven@gimp.org>

	* configure.in: removed custom error message from checks for babl
	and GEGL. The default error message is a lot more helpful.

2008-10-02  Sven Neumann  <sven@gimp.org>

	* app/tools/gimpgegltool.c (gimp_gegl_tool_operation_blacklisted):
	add "text" to the list of blacklisted operations.

2008-10-02  Michael Natterer  <mitch@gimp.org>

	Bug 554646 – Opening Help crashes GIMP with lqr-plugin installed

	* app/widgets/gimphelp.c (gimp_help_get_help_domains): need to
	assign (*foo)[i] and not *foo[i] of a gchar** returned via return
	value location.

2008-10-02  Michael Natterer  <mitch@gimp.org>

	* app/plug-in/gimppluginprocframe.c: keep a reference to the
	proc_frame's procedure. We can't asume it's always there since it
	could be a temporary one and its plug-in might die during
	procedure execution, taking the temp_proc with it.

2008-10-02  Martin Nordholts  <martinn@svn.gnome.org>

	Bug 553534 – centering issues after image scaling and setting zoom
	to 100%

	* app/display/display-enums.h: Added a GimpZoomFocus enum with
	'best guess', 'pointer' or 'image center' values.

	* app/display/gimpdisplayshell-scale.[ch]
	(gimp_display_shell_scale): Take a GimpZoomFocus parameter and
	pass it on to

	(gimp_display_shell_scale_get_zoom_focus): which returns the
	requested zoom focus point if one was given, else makes a best
	guess.

	* app/actions/view-commands.c
	* app/display/gimpstatusbar.c
	* app/display/gimpnavigationeditor.c
	* app/display/gimpdisplayshell-callbacks.c
	* app/display/gimpdisplayshell-scale-dialog.c: For explicit-zoom
	commands like "zoom to 100%", always use the image center as the
	zoom focus point. For all other zooming, continue to use the
	best-guess method.

	* app/display/display-enums.c: Regenerated.

2008-10-02  Sven Neumann  <sven@gimp.org>

	Bug 554898 – Compile failure on uri-backend-wget.c

	* plug-ins/file-uri/uri-backend-wget.c: removed spurious commas
	that broke the build.

2008-10-01  Sven Neumann  <sven@gimp.org>

	* Makefile.am (EXTRA_DIST): added ChangeLog.pre-2-6 and NEWS.pre-2-6.

2008-10-01  Sven Neumann  <sven@gimp.org>

	* tools/gimptool.c: create the target directory and intermediate
	parent directories as needed. Restores the behavior of the
	gimptool shell script.

2008-10-01  Sven Neumann  <sven@gimp.org>

	* menus/Makefile.am (%.xml): added a dependency on configure.in to
	make sure that the image-menu.xml file is rebuilt when the version
	number is changed.

2008-10-01  Tor Lillqvist  <tml@novell.com>

	* app/plug-in/gimpplugin.c
	* app/widgets/gtkscalebutton.c: : Don't #define _GNU_SOURCE on
	Windows as it confuses newest mingw headers.

2008-10-01  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version to 2.6.1 (interface age 1).

2008-09-30  Sven Neumann  <sven@gimp.org>

	* Made 2.6.0 release.

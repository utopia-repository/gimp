Description: fix denial of service and possible code execution via
 malformed PSP image file
Origin: upstream, http://git.gnome.org/browse/gimp/commit/?id=48ec15890e1751dede061f6d1f469b6508c13439
Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=608497
Bug: https://bugzilla.gnome.org/show_bug.cgi?id=639203

Index: gimp-2.6.11/plug-ins/common/file-psp.c
===================================================================
--- gimp-2.6.11.orig/plug-ins/common/file-psp.c	2011-04-07 10:55:48.556192230 -0400
+++ gimp-2.6.11/plug-ins/common/file-psp.c	2011-04-07 10:55:58.576192227 -0400
@@ -1244,6 +1244,10 @@
             }
           else
             fread (buf, runcount, 1, f);
+
+          /* prevent buffer overflow for bogus data */
+          runcount = MIN (runcount, endq - q);
+
           if (bytespp == 1)
             {
               memmove (q, buf, runcount);

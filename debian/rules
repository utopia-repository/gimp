#!/usr/bin/make -f
# GIMP's debian/rules file. Uses debhelper by Joey Hess.
# Based on sample debhelper debian/rules file.
# Written 2 Jun 1998 by Ben Gertzfield <che@debian.org>

build: build-stamp
build-stamp:
	dh_testdir
	automake
	aclocal
	autoconf
	# Add here commands to compile the pacckage.
	./configure --prefix=/usr
	$(MAKE)
# 	Commented out because you have to be in X to build the docs, yuck
#	cd docs && $(MAKE)
#	cd ..
	touch build-stamp

clean:
	dh_testdir
	dh_testroot
	-rm -f build-stamp install-stamp
	# Add here commands to clean up after the build process.
	-$(MAKE) clean
	-$(MAKE) distclean
	rm -rf debian/{gimp,gimp-nonfree,libgimp1,libgimp-dev}
	find . -name '*.o' -o -name '_libs' -o -name '*.lo' -o -name '*.a' -o -name '*.P' -o -name 'Makefile' | xargs rm -rf
	-rm app/gimp
	dh_clean

# Build architecture-independent files here.
binary-indep: build
# We have nothing to do by default.

# Build architecture-dependent files here.
binary-arch: build install gimp-nonfree gimp libgimp-dev libgimp1

install: install-stamp
install-stamp: build
	dh_testdir
	dh_testroot
	dh_clean
	dh_installdirs usr/X11R6/bin usr/X11R6/man/man1
	$(MAKE) prefix=`pwd`/debian/tmp/usr install
	mv debian/tmp/usr/bin/gimp debian/tmp/usr/X11R6/bin
	mv debian/tmp/usr/man/man1/gimp.1 debian/tmp/usr/X11R6/man/man1
	touch install-stamp

libgimp1: build install
	dh_testdir -plibgimp1 
	dh_testroot -plibgimp1
	dh_installdirs -plibgimp1
	rm -rf debian/tmp/usr/bin debian/tmp/usr/X11R6 debian/tmp/usr/include \
	  debian/tmp/usr/share debian/tmp/usr/lib/*.la debian/tmp/usr/man debian/tmp/usr/lib/gimp
	dh_installdocs -plibgimp1
	dh_installchangelogs -plibgimp1
	dh_strip -plibgimp1
	dh_compress -plibgimp1
	dh_fixperms -plibgimp1
	dh_installdeb -plibgimp1
	dh_shlibdeps -plibgimp1
	dh_gencontrol -plibgimp1
	dh_makeshlibs -plibgimp1 -V
	dh_md5sums -plibgimp1
	dh_builddeb -plibgimp1

gimp: build install
	dh_testdir -pgimp 
	dh_testroot -pgimp
	dh_clean -k -pgimp 
	dh_installdirs -pgimp
	dh_movefiles -pgimp
	-rm -f install-stamp
	dh_installdocs -pgimp debian/README.debian docs/*.txt \
	  README docs/Wilber.xcf.gz
	dh_installchangelogs -pgimp ChangeLog
	dh_strip -pgimp
	dh_compress -pgimp
	dh_fixperms -pgimp
	dh_installmenu -pgimp
	dh_installdeb -pgimp
	LD_LIBRARY_PATH=$(shell pwd)/debian/tmp/usr/lib dh_shlibdeps -pgimp
	dh_gencontrol -pgimp
	dh_md5sums -pgimp
	dh_builddeb -pgimp


gimp-nonfree: build install
	dh_testdir -pgimp-nonfree
	dh_testroot -pgimp-nonfree
	dh_clean -k -pgimp-nonfree
	dh_movefiles -pgimp-nonfree
	-rm -f install-stamp
	dh_installdirs -pgimp-nonfree
	dh_installdocs -pgimp-nonfree
	dh_installchangelogs -pgimp-nonfree
	dh_strip -pgimp-nonfree
	dh_compress -pgimp-nonfree
	dh_fixperms -pgimp-nonfree
	dh_installdeb -pgimp-nonfree
	LD_LIBRARY_PATH=$(shell pwd)/debian/tmp/usr/lib dh_shlibdeps -pgimp-nonfree
	dh_gencontrol -pgimp-nonfree
	dh_md5sums -pgimp-nonfree
	dh_builddeb -pgimp-nonfree

libgimp-dev: build install
	dh_testdir -plibgimp-dev
	dh_testroot -plibgimp-dev
	dh_clean -plibgimp-dev -k
	dh_installdirs -plibgimp-dev
	dh_movefiles -plibgimp-dev
	-rm -f install-stamp
	dh_installdocs -plibgimp-dev  
	dh_installchangelogs -plibgimp-dev
	dh_strip -plibgimp-dev
	dh_compress -plibgimp-dev
	dh_fixperms -plibgimp-dev
	dh_installdeb -plibgimp-dev
	dh_shlibdeps -plibgimp-dev
	dh_gencontrol -plibgimp-dev
	dh_md5sums -plibgimp-dev
	dh_builddeb -plibgimp-dev

source diff:                                                                  
	@echo >&2 'source and diff are obsolete - use dpkg-source -b'; false

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary
